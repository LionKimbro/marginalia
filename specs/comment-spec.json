{
  "marginalia": {
    "version": "0.1",
    "purpose": "Provide structured, comment-based metadata for describing the functional organization of Python code without affecting runtime behavior.",
    "scope": "Static source analysis",
    "binding_rule": "A meta comment applies to the immediately following bindable symbol; if an @anchor is present, the comment binds to that anchor; if a #id is present, it defines the canonical identifier for the bound symbol.",
    "syntax": {
      "comment_prefix": "# meta:",
      "entry_format": "key=value_list",
      "separator": "whitespace",
      "value_separator": ",",
      "key_character_set": "a-zA-Z0-9_-",
      "value_character_set": "a-zA-Z0-9_-#*",
      "anchor_prefix": "@",
      "anchor_character_set": "a-zA-Z0-9_-",
      "case_sensitive": true,
      "id_prefix": "#",
      "id_character_set": "a-zA-Z0-9_-",
      "id_multiplicity": "at_most_one"
    },
    "examples": [
      {
        "description": "Binding metadata to a g-var entry using an explicit anchor",
        "source": [
          "g = {",
          "  # meta: @X modules=coordinates threads=main flags=g",
          "  \"X\": 0,",
          "",
          "  # meta: @Y modules=coordinates threads=main flags=g",
          "  \"Y\": 0",
          "}"
        ],
        "binding_result": {
          "X": {
            "symbol_type": "anchor",
            "modules": [
              "coordinates"
            ],
            "threads": [
              "main"
            ],
            "flags": "g"
          },
          "Y": {
            "symbol_type": "anchor",
            "modules": [
              "coordinates"
            ],
            "threads": [
              "main"
            ],
            "flags": "g"
          }
        }
      }
    ],
    "parsing_rules": {
      "multiple_entries_allowed": true,
      "unknown_keys_allowed": true,
      "duplicate_keys": "last_wins",
      "whitespace": "ignored_around_separators",
      "ordering": "insignificant"
    },
    "binding": {
      "targets": [
        "function",
        "class",
        "data",
        "anchor"
      ],
      "scope_limit": "next_bindable_symbol",
      "anchor_binding": {
        "requires_explicit_anchor": true,
        "implicit_binding": false
      },
      "id_binding": {
        "optional": true,
        "creates_symbol": false,
        "overrides_derived_id": true,
        "scope": "bound_symbol"
      }
    },
    "keys": {
      "modules": {
        "type": "set<string>",
        "description": "Logical modules or functional groupings that the symbol participates in.",
        "semantics": "Descriptive; does not imply physical module boundaries.",
        "examples": [
          "db",
          "conversation",
          "clipboard"
        ]
      },
      "threads": {
        "type": "set<string>",
        "description": "Logical execution or call-path contexts in which the symbol is expected to run.",
        "semantics": "Narrative or conceptual threads, not OS-level concurrency primitives.",
        "examples": [
          "main",
          "startup",
          "ui-loop"
        ]
      },
      "callers": {
        "type": "array<string> | string | integer",
        "description": "Approximate cardinality of call sites for the symbol.",
        "allowed_values": {
          "*": "Unbounded or general-purpose usage",
          "array": "Explicit list of calling symbols",
          "integer": "Expected number of distinct call sites"
        },
        "semantics": "Informational; may be validated by tooling but never enforced."
      },
      "flags": {
        "type": "set<character>",
        "description": "User-defined categorical markers with externally defined meanings.",
        "semantics": "Opaque to Marginalia; interpreted only by consuming tools or users.",
        "examples": [
          "D",
          "#",
          "X"
        ]
      }
    },
    "extensibility": {
      "custom_keys": true,
      "reserved_keys": [
        "modules",
        "threads",
        "callers",
        "flags"
      ],
      "forward_compatibility": "Tools must ignore unknown keys.",
      "structural_fields": [
        "id",
        "anchor"
      ]
    },
    "non_goals": [
      "Runtime behavior modification",
      "Static type enforcement",
      "Dependency resolution",
      "Call graph enforcement"
    ],
    "output_recommendation": {
      "normalized_representation": {
        "id": "string",
        "id_source": "explicit | derived",
        "symbol_name": "string",
        "symbol_type": "function | class | data | anchor",
        "source_file": "string",
        "line_number": "integer",
        "meta": "object<string, set<string> | string | integer>"
      }
    }
  }
}
