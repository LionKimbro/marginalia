{
  "marginalia_cli": {
    "version": "0.3",
    "command": "marginalia",
    "purpose": "Static analysis tool for extracting Marginalia meta comments from Python source code and producing structured artifacts through explicit execution modes.",
    "design_principles": [
      "Single-purpose execution modes",
      "Inventory-first architecture",
      "File-based artifact boundaries",
      "Composable multi-step workflows",
      "JSON-first outputs",
      "Structured execution summaries"
    ],
    "invocation": {
      "pattern": "marginalia <mode> [arguments] [options]",
      "stdout": "Used only for optional printing of execution summaries and human-readable messages",
      "stderr": "Reserved for internal debugging and fatal execution failures",
      "default_exit_code": 0
    },
    "modes": {
      "scan": {
        "description": "Scan Python source files and generate a canonical Marginalia inventory artifact.",
        "arguments": {
          "path": {
            "type": "string",
            "description": "Directory to scan for Python source files.",
            "default": "."
          }
        },
        "options": {
          "output": {
            "--output": {
              "type": "string",
              "description": "Path of inventory file to write.",
              "default": "inventory.json"
            }
          },
          "scope": {
            "--files": {
              "type": "string",
              "repeatable": true,
              "description": "Glob pattern restricting which files are scanned."
            },
            "--exclude": {
              "type": "string",
              "repeatable": true,
              "description": "Glob pattern for excluding files or directories."
            }
          }
        },
        "input": {
          "source": "filesystem",
          "reads_source_files": true
        },
        "output": {
          "primary_artifact": {
            "artifact": "inventory",
            "default_filename": "inventory.json",
            "schema": "marginalia.inventory.v0.3"
          },
          "summary_artifact": {
            "artifact": "execution-summary",
            "default_filename": "scan-summary.json",
            "schema": "marginalia.execution-summary.v0.1"
          }
        },
        "invariants": [
          "Inventory is always generated in this mode.",
          "Indexes are never generated in this mode.",
          "All diagnostics are recorded in the execution summary artifact.",
          "Source files are the only semantic input."
        ]
      },
      "index": {
        "description": "Generate index projections from an existing Marginalia inventory artifact.",
        "arguments": {
          "inventory_path": {
            "type": "string",
            "description": "Path to inventory JSON file.",
            "default": "inventory.json"
          }
        },
        "options": {
          "output": {
            "--output": {
              "type": "string",
              "description": "Path of index file to write.",
              "default": "index.json"
            }
          }
        },
        "input": {
          "artifact": "inventory",
          "schema": "marginalia.inventory.v0.3",
          "reads_source_files": false
        },
        "output": {
          "primary_artifact": {
            "artifact": "indexes",
            "default_filename": "index.json",
            "schema": "marginalia.indexes.v0.3"
          },
          "summary_artifact": {
            "artifact": "execution-summary",
            "default_filename": "index-summary.json",
            "schema": "marginalia.execution-summary.v0.1"
          }
        },
        "invariants": [
          "Indexes must be derived solely from the provided inventory.",
          "No source files are read in this mode.",
          "Inventory contents are not modified.",
          "All diagnostics are recorded in the execution summary artifact."
        ]
      }
    },
    "universal-options": {
      "--summary": {
        "type": "string",
        "description": "Path of execution summary file to write.",
        "default": "<mode>-summary.json"
      },
      "--print-summary": {
        "type": "boolean",
        "description": "Print execution summary JSON to stdout after completion.",
        "default": true
      },
      "--fail": {
        "type": "string",
        "allowed_values": [
          "warn",
          "halt"
        ],
        "default": "halt",
        "description": "Failure handling policy when errors are encountered."
      },
      "--json": {
        "type": "string",
        "allowed_values": [
          "pretty",
          "compact"
        ],
        "default": "pretty",
        "description": "JSON formatting style for output artifacts."
      },
      "--version": {
        "type": "boolean",
        "description": "Print Marginalia version and exit."
      },
      "--help": {
        "type": "boolean",
        "description": "Print CLI usage information and exit."
      }
    },
    "execution_summary_schema_stub": {
      "version": "marginalia.execution-summary.v0.1",
      "description": "Structured record of a Marginalia execution run. This schema is intentionally minimal and extensible.",
      "shape": {
        "invocation": {
          "command-line": "string",
          "execution-mode": "scan | index",
          "time-of-execution": "float | string"
        },
        "result": "success | failure",
        "warnings": "array",
        "errors": "array",
        "notes": "optional array or object for future extensions",
        "metrics": {
          "files_scanned": "int",
          "symbols_found": "int",
          "warnings_count": "int",
          "errors_count": "int"
        }
      }
    },
    "exit_codes": {
      "0": "Success (no errors, or --fail=warn w/ recoverable or tolerable errors)",
      "1": "Usage or argument error",
      "2": "Parse or schema validation error (malformed inventory.json input)",
      "3": "Failure policy halt condition triggered (--fail=halt, no errors tolerated)",
      "4": "Filesystem or IO error (cannot read base path, cannot output files, permission denied)"
    },
    "global_invariants": [
      "Each execution produces exactly one primary artifact.",
      "Each execution produces exactly one execution summary artifact.",
      "Execution modes do not perform multiple pipeline stages.",
      "Inventory is the canonical representation of Marginalia analysis.",
      "All projections must be derivable from inventory artifacts.",
      "All warnings and errors are recorded in execution summaries."
    ]
  }
}
